{"version":3,"sources":["../../../src/components/Gallery/Gallery.tsx"],"sourcesContent":["'use client';\n\nimport * as React from 'react';\nimport { clamp } from '../../helpers/math';\nimport { useExternRef } from '../../hooks/useExternRef';\nimport { useFocusWithin } from '../../hooks/useFocusWithin';\nimport { useIsClient } from '../../hooks/useIsClient';\nimport { callMultiple } from '../../lib/callMultiple';\nimport { useIsomorphicLayoutEffect } from '../../lib/useIsomorphicLayoutEffect';\nimport { CarouselBase } from '../CarouselBase/CarouselBase';\nimport type { BaseGalleryProps } from '../CarouselBase/types';\nimport { useAutoPlay } from './hooks';\n\nexport interface GalleryProps extends BaseGalleryProps {\n  /**\n   * Индекс слайда по умолчанию.\n   */\n  initialSlideIndex?: number;\n  /**\n   * При передаче происходит автоматический переход к следующему слайду через переданное время в ms.\n   * Автоматический переход будет ставиться на паузу при:\n   * - начале свайпа для переключения слайда;\n   * - фокусе на любой элемент внутри компонента;\n   * - при наведении мыши на компонент.\n   */\n  timeout?: number;\n}\n\n/**\n * @see https://vkui.io/components/gallery\n */\nexport const Gallery = ({\n  initialSlideIndex = 0,\n  children,\n  timeout = 0,\n  onChange,\n  bullets,\n  onDragStart,\n  onDragEnd,\n  getRootRef,\n  onMouseOver,\n  onMouseOut,\n  ...props\n}: GalleryProps): React.ReactNode => {\n  const rootRef = useExternRef(getRootRef);\n  const [localSlideIndex, setSlideIndex] = React.useState(initialSlideIndex);\n  const isControlled = typeof props.slideIndex === 'number';\n  const slideIndex = isControlled ? (props.slideIndex ?? 0) : localSlideIndex;\n  const slides = React.useMemo(\n    () => React.Children.toArray(children).filter((item) => Boolean(item)),\n    [children],\n  );\n  const childCount = slides.length;\n  const isClient = useIsClient();\n  const focusWithin = useFocusWithin(rootRef);\n\n  const handleChange: GalleryProps['onChange'] = React.useCallback(\n    (current: number) => {\n      if (current === slideIndex) {\n        return;\n      }\n      !isControlled && setSlideIndex(current);\n      onChange && onChange(current);\n    },\n    [isControlled, onChange, slideIndex],\n  );\n\n  const autoPlayControls = useAutoPlay({\n    timeout,\n    slideIndex,\n    onNext: () => handleChange((slideIndex + 1) % childCount),\n  });\n\n  // prevent invalid slideIndex\n  // any slide index is invalid with no slides, just keep it as is\n  const safeSlideIndex = childCount > 0 ? clamp(slideIndex, 0, childCount - 1) : slideIndex;\n  // notify parent in controlled mode\n  React.useEffect(() => {\n    if (onChange && safeSlideIndex !== slideIndex) {\n      onChange(safeSlideIndex);\n    }\n    setSlideIndex(safeSlideIndex);\n  }, [onChange, safeSlideIndex, slideIndex]);\n\n  useIsomorphicLayoutEffect(\n    () => (focusWithin ? autoPlayControls.pause() : autoPlayControls.resume()),\n    [focusWithin, autoPlayControls.pause, autoPlayControls.resume],\n  );\n\n  if (!isClient) {\n    return null;\n  }\n\n  return (\n    <CarouselBase\n      dragDisabled={isControlled && !onChange}\n      getRootRef={rootRef}\n      {...props}\n      onDragStart={callMultiple(onDragStart, autoPlayControls.pause)}\n      onDragEnd={callMultiple(onDragEnd, autoPlayControls.resume)}\n      onMouseEnter={callMultiple(onMouseOver, autoPlayControls.pause)}\n      onMouseLeave={callMultiple(onMouseOut, autoPlayControls.resume)}\n      bullets={childCount > 0 && bullets}\n      slideIndex={safeSlideIndex}\n      onChange={handleChange}\n    >\n      {slides}\n    </CarouselBase>\n  );\n};\n"],"names":["React","clamp","useExternRef","useFocusWithin","useIsClient","callMultiple","useIsomorphicLayoutEffect","CarouselBase","useAutoPlay","Gallery","initialSlideIndex","children","timeout","onChange","bullets","onDragStart","onDragEnd","getRootRef","onMouseOver","onMouseOut","props","rootRef","localSlideIndex","setSlideIndex","useState","isControlled","slideIndex","slides","useMemo","Children","toArray","filter","item","Boolean","childCount","length","isClient","focusWithin","handleChange","useCallback","current","autoPlayControls","onNext","safeSlideIndex","useEffect","pause","resume","dragDisabled","onMouseEnter","onMouseLeave"],"mappings":"AAAA;;;;;AAEA,YAAYA,WAAW,QAAQ;AAC/B,SAASC,KAAK,QAAQ,wBAAqB;AAC3C,SAASC,YAAY,QAAQ,8BAA2B;AACxD,SAASC,cAAc,QAAQ,gCAA6B;AAC5D,SAASC,WAAW,QAAQ,6BAA0B;AACtD,SAASC,YAAY,QAAQ,4BAAyB;AACtD,SAASC,yBAAyB,QAAQ,yCAAsC;AAChF,SAASC,YAAY,QAAQ,kCAA+B;AAE5D,SAASC,WAAW,QAAQ,aAAU;AAiBtC;;CAEC,GACD,OAAO,MAAMC,UAAU;QAAC,EACtBC,oBAAoB,CAAC,EACrBC,QAAQ,EACRC,UAAU,CAAC,EACXC,QAAQ,EACRC,OAAO,EACPC,WAAW,EACXC,SAAS,EACTC,UAAU,EACVC,WAAW,EACXC,UAAU,EAEG,WADVC;QAVHV;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;;IAGA,MAAME,UAAUnB,aAAae;IAC7B,MAAM,CAACK,iBAAiBC,cAAc,GAAGvB,MAAMwB,QAAQ,CAACd;IACxD,MAAMe,eAAe,OAAOL,MAAMM,UAAU,KAAK;QACdN;IAAnC,MAAMM,aAAaD,eAAgBL,CAAAA,oBAAAA,MAAMM,UAAU,cAAhBN,+BAAAA,oBAAoB,IAAKE;IAC5D,MAAMK,SAAS3B,MAAM4B,OAAO,CAC1B,IAAM5B,MAAM6B,QAAQ,CAACC,OAAO,CAACnB,UAAUoB,MAAM,CAAC,CAACC,OAASC,QAAQD,QAChE;QAACrB;KAAS;IAEZ,MAAMuB,aAAaP,OAAOQ,MAAM;IAChC,MAAMC,WAAWhC;IACjB,MAAMiC,cAAclC,eAAekB;IAEnC,MAAMiB,eAAyCtC,MAAMuC,WAAW,CAC9D,CAACC;QACC,IAAIA,YAAYd,YAAY;YAC1B;QACF;QACA,CAACD,gBAAgBF,cAAciB;QAC/B3B,YAAYA,SAAS2B;IACvB,GACA;QAACf;QAAcZ;QAAUa;KAAW;IAGtC,MAAMe,mBAAmBjC,YAAY;QACnCI;QACAc;QACAgB,QAAQ,IAAMJ,aAAa,AAACZ,CAAAA,aAAa,CAAA,IAAKQ;IAChD;IAEA,6BAA6B;IAC7B,gEAAgE;IAChE,MAAMS,iBAAiBT,aAAa,IAAIjC,MAAMyB,YAAY,GAAGQ,aAAa,KAAKR;IAC/E,mCAAmC;IACnC1B,MAAM4C,SAAS,CAAC;QACd,IAAI/B,YAAY8B,mBAAmBjB,YAAY;YAC7Cb,SAAS8B;QACX;QACApB,cAAcoB;IAChB,GAAG;QAAC9B;QAAU8B;QAAgBjB;KAAW;IAEzCpB,0BACE,IAAO+B,cAAcI,iBAAiBI,KAAK,KAAKJ,iBAAiBK,MAAM,IACvE;QAACT;QAAaI,iBAAiBI,KAAK;QAAEJ,iBAAiBK,MAAM;KAAC;IAGhE,IAAI,CAACV,UAAU;QACb,OAAO;IACT;IAEA,qBACE,KAAC7B;QACCwC,cAActB,gBAAgB,CAACZ;QAC/BI,YAAYI;OACRD;QACJL,aAAaV,aAAaU,aAAa0B,iBAAiBI,KAAK;QAC7D7B,WAAWX,aAAaW,WAAWyB,iBAAiBK,MAAM;QAC1DE,cAAc3C,aAAaa,aAAauB,iBAAiBI,KAAK;QAC9DI,cAAc5C,aAAac,YAAYsB,iBAAiBK,MAAM;QAC9DhC,SAASoB,aAAa,KAAKpB;QAC3BY,YAAYiB;QACZ9B,UAAUyB;kBAETX;;AAGP,EAAE"}